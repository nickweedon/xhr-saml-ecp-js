/*! xhr-saml-ecp-js 2016-06-11 */
define("xhr-saml-ecp-js",["xhr-adaptor-js","xhr-blocking-queue-js","saml-ecp-client-js"],function(a,b,c){function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function e(a){for(var b in h.SamlEcpClientXHR.configObj.aclList)if(h.SamlEcpClientXHR.configObj.aclList.hasOwnProperty(b)){var c=h.SamlEcpClientXHR.configObj.aclList[b];if(new RegExp(c.urlPattern,"g").test(a))return c}return null}var f=b,g=c,h=h||{},h=h||{};return h.SamlEcpClientXHR=function(a){f.BlockingRequestQueueXHR.prototype.constructor.call(this,a)},h.SamlEcpClientXHR.prototype=Object.create(f.BlockingRequestQueueXHR.prototype),h.SamlEcpClientXHR.constructor=h.SamlEcpClientXHR,h.SamlEcpClientXHR.responseHandler=function(a,b){var c=e(b.openArgs[1]);if(null===c)return void a(!0);var f=g.Client.parseResponseHeadersString(b.getAllResponseHeaders()),i=g.Client.isResponseAnAuthRequest(f,b.responseText);if(!i)return void a(!0);var j={xhrFactory:function(){var a=new XMLHttpRequest;return a.bypassFilter=!0,a},retrieveResource:!1},k={};d(k,h.SamlEcpClientXHR.configObj.options),d(k,j);var l=new g.Client(k),m={};d(m,c.options),m.onSuccess=function(){void 0!==c.options&&void 0!==c.options.onSuccess&&c.options.onSuccess.apply(this,arguments),b.bypassFilter=!0,b.resend(),b.bypassFilter=!1,a(!1)},m.onEcpError=function(){void 0!==c.options&&void 0!==c.options.onEcpError&&c.options.onEcpError.apply(this,arguments),a(!1)},m.onError=function(){void 0!==c.options&&void 0!==c.options.onError&&c.options.onError.apply(this,arguments),a(!1)},m.onSamlTimeout=function(){void 0!==c.options&&void 0!==c.options.onSamlTimeout&&c.options.onSamlTimeout.apply(this,arguments),a(!1)},m.onResourceTimeout=function(){void 0!==c.options&&void 0!==c.options.onResourceTimeout&&c.options.onResourceTimeout.apply(this,arguments),a(!1)},l.auth(b.openArgs[0],b.responseText,b.openArgs[1],b.sendArgs[0],m,b.getAllRequestHeaders())},h.SamlEcpClientXHR.config=function(a){h.SamlEcpClientXHR.configObj=a;for(var b in a.aclList)if(a.aclList.hasOwnProperty(b)){var c=a.aclList[b];f.BlockingRequestQueueXHR.registerResponseHandler(c.urlPattern,this.responseHandler)}},h.SamlEcpClientXHR.prototype.send=function(){var a=e(this.openArgs[1]);null!==a&&(this.isRequestHeaderSet("PAOS")||this.setRequestHeader("PAOS",'ver="urn:liberty:paos:2003-08";"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"'),this.isRequestHeaderSet("ACCEPT")||this.setRequestHeader("Accept","*/*"),this.requestHeaderContains("ACCEPT","text/html; application/vnd.paos+xml")||this.setRequestHeader("Accept","text/html; application/vnd.paos+xml")),f.BlockingRequestQueueXHR.prototype.send.apply(this,arguments)},h});