/*! xhr-saml-ecp-js 2015-12-29 */
define("xhr-saml-ecp-js",["xhr-adaptor-js","xhr-blocking-queue-js","saml-ecp-client-js"],function(a,b,c){function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function e(a){for(var b in h.SamlEcpClientXHR.configObj.aclList)if(h.SamlEcpClientXHR.configObj.aclList.hasOwnProperty(b)){var c=h.SamlEcpClientXHR.configObj.aclList[b];if(new RegExp(c.urlPattern,"g").test(a))return c}return null}var f=b,g=c,h=h||{},h=h||{};return h.SamlEcpClientXHR=function(a){f.BlockingRequestQueueXHR.prototype.constructor.call(this,a)},h.SamlEcpClientXHR.prototype=Object.create(f.BlockingRequestQueueXHR.prototype),h.SamlEcpClientXHR.constructor=h.SamlEcpClientXHR,h.SamlEcpClientXHR.responseHandler=function(a,b){var c=e(b.openArgs[1]);if(null===c)return void a(!0);var f=g.Client.parseResponseHeadersString(b.getAllResponseHeaders()),i=g.Client.isResponseAnAuthRequest(f,b.responseText);if(!i)return void a(!0);var j={xhrFactory:function(){var a=new XMLHttpRequest;return a.bypassFilter=!0,a}},k={};d(k,h.SamlEcpClientXHR.configObj.options),d(k,j);var l=new g.Client(k),m={};d(m,c.options),m.onSuccess=function(){void 0!==c.options&&void 0!==c.options.onSuccess&&c.options.onSuccess.apply(this,arguments),a(!1),b.open.apply(b,b.openArgs),b.send()},l.auth(b.responseText,b.openArgs[1],m)},h.SamlEcpClientXHR.config=function(a){h.SamlEcpClientXHR.configObj=a;for(var b in a.aclList)if(a.aclList.hasOwnProperty(b)){var c=a.aclList[b];f.BlockingRequestQueueXHR.registerResponseHandler(c.urlPattern,this.responseHandler)}},h.SamlEcpClientXHR.prototype.open=function(){this.requestHeaders={},f.BlockingRequestQueueXHR.prototype.open.apply(this,arguments)},h.SamlEcpClientXHR.prototype.setRequestHeader=function(a,b){this.requestHeaders[a.toLowerCase()]=b,f.BlockingRequestQueueXHR.prototype.setRequestHeader.apply(this,arguments)},h.SamlEcpClientXHR.prototype.send=function(){if(!this.isPAOSHeaderSet){var a=e(this.openArgs[1]);null!==a&&(this.requestHeaders.hasOwnProperty("paos")||this.setRequestHeader("PAOS",'ver="urn:liberty:paos:2003-08";"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"'),this.requestHeaders.hasOwnProperty("accept")||this.setRequestHeader("Accept","*/*"),this.setRequestHeader("Accept","text/html; application/vnd.paos+xml"))}f.BlockingRequestQueueXHR.prototype.send.apply(this,arguments)},h});